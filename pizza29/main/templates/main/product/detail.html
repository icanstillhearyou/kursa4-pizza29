{% extends "main/base.html" %}
{% load static %}

{% block title %}
    {{ product.name }}
{% endblock title %}

{% block content %}
    <div class="detail-product d-flex">
        <div class="detail-img">
            <img src="{% if product.image %}{{ product.image.url }}{% else %}{% static 'img/noimage.jpg' %}{% endif %}" alt="" class="detail-image">
        </div>
        <div class="detail-description">
            <h2>{{ product.name }}</h2>
            <h3>Категория: {{ product.category }}</h3>
            <p>Описание: {{ product.description|linebreaks }}</p>
            <p class="mb-2">Доступные размеры:</p>
            
            {% if price_items.exists %}
                <div class="price-table mb-3">
                    <table class="table table-bordered text-center">
                        <thead>
                            <tr>
                                {% for price_item in price_items %}
                                    <th>{{ price_item.product_size.size.name }} ({{ price_item.product_size.size.diameter }} см)</th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                {% for price_item in price_items %}
                                    <td>
                                        {% if price_item.discount %}
                                            {% comment %} <div class="cart-discount d-flex flex-row align-items-center justify-content-center gap-2"> {% endcomment %}
                                            <div>
                                                <span class="line">{{ price_item.price }} ₽</span>
                                                <span>{{ price_item.sell_price }} ₽</span>
                                            </div>
                                        {% else %}
                                            <span>{{ price_item.price }} ₽</span>
                                        {% endif %}
                                    </td>
                                {% endfor %}
                            </tr>
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p class="price">Цена не указана</p>
            {% endif %}

            <form action="{% url "cart:cart_add" product.id %}" class="q-form" method="post">
                <div class="cart-form">
                    <div class="form-group mb-3">
                        <label for="{{ cart_product_form.size.id_for_label }}">Размер:</label>
                        {{ cart_product_form.size }}
                    </div>
                    <div class="form-group">
                        <label for="{{ cart_product_form.quantity.id_for_label }}">Количество:</label>
                        {{ cart_product_form.quantity }}
                    </div>
                    {{ cart_product_form.override }}
                    {% csrf_token %}
                </div>
                <input type="submit" class="add-to-cart-btn" value="Добавить в корзину">
            </form>
        </div>
    </div>
{% endblock content %}